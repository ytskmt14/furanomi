# Implementation Plan

- [x] 1. 進捗インジケーターコンポーネントの実装
- [x] 1.1 ステップ表示コンポーネントを作成
  - 現在のステップを強調表示する機能
  - 完了したステップを視覚的にマークする機能（チェックマークなど）
  - 未完了のステップをグレーアウトまたは非アクティブ表示する機能
  - ステップ番号と総ステップ数の表示（例：ステップ1/6）
  - 完了したステップへのクリックで戻る機能
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 2. マルチステップフォームの基盤実装
- [x] 2.1 フォーム状態管理の実装
  - 全ステップのフォームデータを一元管理する状態管理機能
  - 各ステップ間でデータを保持する機能
  - 前のステップに戻った際に入力済み情報を表示する機能
  - エラー状態の管理機能
  - _Requirements: 1.3, 10.3_

- [x] 2.2 ステップ遷移ロジックの実装
  - 次のステップへ進む機能
  - 前のステップに戻る機能
  - ステップ間の遷移アニメーション
  - 完了したステップの記録機能
  - _Requirements: 1.1, 1.2, 1.3_

- [x] 2.3 バリデーション機能の実装
  - 各ステップでの必須項目チェック機能
  - フィールドレベルのバリデーション機能
  - エラーメッセージの表示機能
  - エラー発生時に該当項目まで自動スクロールする機能
  - バリデーション成功時のみ次のステップへ進む機能
  - _Requirements: 1.4, 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 3. 基本情報入力ステップの実装
- [x] 3.1 店舗基本情報入力フォームの実装
  - 店舗名入力フィールド（最大200文字制限、文字数カウンター表示）
  - 店舗説明入力フィールド（文字数カウンター表示）
  - カテゴリ選択フィールド（レストラン、カフェ、居酒屋の選択肢を明確に表示）
  - 必須項目の視覚的インジケーター（「*」マーク）表示
  - 入力ガイド（ツールチップ、プレースホルダー）の表示
  - _Requirements: 2.1, 2.2, 2.3, 7.1, 10.4_

- [x] 3.2 基本情報バリデーションの実装
  - 店舗名の文字数制限チェック（200文字以内）
  - 店舗名の必須チェック
  - カテゴリの必須チェック
  - エラーメッセージの表示（具体的なエラーメッセージと正しい入力例）
  - _Requirements: 2.1, 7.2, 7.4_

- [x] 4. 住所・位置情報入力ステップの実装
- [x] 4.1 住所入力機能の実装
  - 郵便番号入力フィールド（既存のPostalCodeInputコンポーネントを再利用）
  - 郵便番号から住所を自動補完する機能
  - 住所入力フィールド
  - 住所詳細（番地・建物名）入力フィールド
  - 必須項目の視覚的インジケーター表示
  - _Requirements: 2.4, 7.1_

- [x] 4.2 位置情報取得機能の実装
  - 位置取得ボタンの表示（明確に表示）
  - クリック時に地図上で位置を確認できる機能
  - 既存のGeocoding API統合（apiService.geocodeを使用）
  - 緯度経度の表示（読み取り専用）
  - 位置情報取得中のローディング表示
  - _Requirements: 2.5, 2.6_

- [x] 4.3 連絡先情報入力機能の実装
  - 電話番号入力フィールド
  - メールアドレス入力フィールド
  - 電話番号形式のバリデーション
  - メールアドレス形式のバリデーション
  - エラーメッセージの表示
  - _Requirements: 2.7, 7.4_

- [x] 4.4 位置情報バリデーションの実装
  - 緯度経度が取得できていない場合のチェック
  - 位置情報未取得時に次のステップへの進行を阻止する機能
  - エラーメッセージの表示（位置取得を促すメッセージ）
  - _Requirements: 2.6, 7.2_

- [x] 5. 店舗管理者割り当てステップの実装
- [x] 5.1 既存店舗管理者選択機能の実装
  - 既存の店舗管理者一覧から選択するオプション
  - 店舗管理者一覧の表示
  - 選択状態の管理
  - 既存のShopManagerSectionコンポーネントを再利用
  - _Requirements: 3.1_

- [x] 5.2 新規店舗管理者作成機能の実装
  - 新規店舗管理者を作成するオプション
  - ユーザー名、メールアドレス、パスワード、氏名、電話番号の入力フォーム
  - 必須項目（ユーザー名、メールアドレス、パスワード、氏名）のチェック
  - 既存のShopManagerSectionコンポーネントを再利用
  - 新規作成時のAPI呼び出し（apiService.createShopManager）
  - _Requirements: 3.2, 3.3, 3.4_

- [x] 5.3 店舗管理者割り当てバリデーションの実装
  - 店舗管理者が割り当てられていない場合のチェック
  - 店舗管理者未割り当て時に次のステップへの進行を阻止する機能
  - エラーメッセージの表示（店舗管理者の割り当てが必要であることを示す）
  - _Requirements: 3.5, 7.2_

- [x] 6. 営業時間設定ステップの実装
- [x] 6.1 営業時間入力フォームの実装
  - 各曜日ごとに営業開始時刻と終了時刻を設定できるフォーム
  - 時刻入力フィールド（HH:mm形式）
  - 終了時刻が翌日にまたがる場合の「翌日」フラグ設定オプション
  - 休業日の設定オプション
  - デフォルトの営業時間（9:00-21:00）の適用機能
  - _Requirements: 4.1, 4.2, 4.3, 4.5_

- [x] 6.2 営業時間バリデーションの実装
  - 営業時間の形式チェック（HH:mm形式）
  - 不正な形式の場合のエラーメッセージ表示
  - 正しい形式での入力を促すメッセージ
  - 未設定の場合のデフォルト値適用または未設定のまま進める許可
  - _Requirements: 4.4, 4.5_

- [x] 7. 画像アップロードステップの実装
- [x] 7.1 画像選択機能の実装
  - ドラッグ&ドロップで画像を選択できる機能
  - ファイル選択ダイアログで画像を選択できる機能
  - サポートされる画像形式（JPEG、PNG）の表示
  - 最大ファイルサイズの表示
  - サポートされていない形式またはサイズ超過の画像を拒否する機能
  - エラーメッセージの表示
  - _Requirements: 5.1, 5.3, 5.4_

- [x] 7.2 画像プレビュー機能の実装
  - アップロード前に画像プレビューを表示する機能
  - プレビュー画像の表示
  - _Requirements: 5.2_

- [x] 7.3 画像圧縮機能の実装
  - 既存のuseImageCompressionフックを再利用
  - クライアントサイドで画像を自動的に圧縮する機能（最大800x600ピクセル、JPEG品質80%）
  - 圧縮後のBase64エンコード文字列の生成
  - _Requirements: 5.5_

- [x] 8. 公開前確認・プレビューステップの実装
- [x] 8.1 登録情報一覧表示機能の実装
  - 入力したすべての店舗情報を一覧表示する機能
  - 各情報カテゴリごとの表示（基本情報、住所・位置情報、店舗管理者、営業時間、画像）
  - 情報の読み取り専用表示
  - _Requirements: 6.1, 6.2_

- [x] 8.2 利用者アプリプレビュー機能の実装
  - 利用者アプリでの表示プレビューを提供する機能
  - ShopPreviewコンポーネントの実装
  - 店舗カード形式でのプレビュー表示
  - 画像、店舗名、カテゴリ、住所、営業時間などの表示
  - _Requirements: 6.3, 11.9_

- [x] 8.3 情報修正機能の実装
  - 公開前確認画面で情報を修正する機能
  - 該当するステップに戻る機能
  - 修正後の再確認機能
  - _Requirements: 6.4_

- [x] 8.4 店舗作成・公開機能の実装
  - 「公開する」選択時の店舗作成と公開処理
  - 店舗をアクティブ状態（is_active = true）に設定する機能
  - 「後で公開する」選択時の店舗作成処理
  - 店舗を非アクティブ状態（is_active = false）のまま保存する機能
  - API呼び出し（POST /api/shops、PUT /api/shops/system/:id）
  - 送信中のローディング表示
  - _Requirements: 6.5, 6.6_

- [x] 8.5 公開成功表示機能の実装
  - 公開成功メッセージの表示
  - 利用者アプリでの店舗表示へのリンク提供
  - 店舗管理画面から利用者アプリでの表示を確認できるリンク提供
  - 登録完了画面の表示
  - 次のアクション（公開前確認など）の案内
  - _Requirements: 1.5, 9.1, 9.2, 9.4_

- [x] 9. エラーハンドリングとガイダンスの実装
- [x] 9.1 エラーメッセージ表示機能の実装
  - 具体的で理解しやすいエラーメッセージの表示
  - フィールドレベルのエラーメッセージ表示
  - グローバルレベルのエラーメッセージ表示
  - ネットワークエラー時のエラーメッセージ表示
  - 再試行オプションの提供
  - _Requirements: 10.1, 10.2_

- [x] 9.2 入力ガイド機能の実装
  - 各入力フィールドにフォーカス時の入力ガイド表示（ツールチップ、プレースホルダー）
  - ヘルプリンクまたはサポート情報へのアクセス提供
  - _Requirements: 10.4, 10.5_

- [x] 9.3 エラー回復機能の実装
  - エラー発生時に入力済みの情報を保持する機能
  - エラー修正後の再送信機能
  - エラー状態のクリア機能
  - _Requirements: 10.3_

- [x] 10. 店舗管理者向け公開前編集機能の拡張
- [x] 10.1 公開前ステータス表示機能の実装
  - ログイン時に紐づけられた店舗が公開前（is_active = false）の場合の表示
  - 「公開前」または「未公開」のステータスバッジ表示
  - 公開前であることを明確に表示する機能
  - 既存のShopInfoEditコンポーネントに統合
  - _Requirements: 11.1, 11.2, 11.3_

- [x] 10.2 公開前店舗情報編集機能の実装
  - 店舗名、説明、住所、電話番号、メールアドレス、カテゴリ、営業時間、画像の編集機能
  - 位置情報（緯度経度）の編集機能（システム管理者による位置取得と同様の機能）
  - 既存のShopFormFieldsコンポーネントを再利用
  - 既存のuseImageCompressionフックを再利用
  - 必須項目のバリデーション実行（店舗名、住所、位置情報など）
  - _Requirements: 11.4, 11.5, 11.8_

- [x] 10.3 公開状態制御機能の実装
  - 店舗の公開状態（is_active）は変更できないようにする機能（店舗管理者は公開/非公開の切り替えができない）
  - 保存時にis_activeを変更しないAPI呼び出し（PUT /api/shops/:id）
  - _Requirements: 11.7_

- [x] 10.4 公開前プレビュー機能の実装
  - 利用者アプリでの表示プレビューを提供する機能（公開前でもプレビュー可能）
  - ShopPreviewコンポーネントを再利用
  - _Requirements: 11.9_

- [x] 10.5 案内メッセージ表示機能の実装
  - 編集完了時の成功メッセージ表示（「店舗情報を更新しました」など）
  - 「公開準備が完了したらシステム管理者に連絡してください」などの案内メッセージ表示
  - _Requirements: 11.10, 11.11_

- [x] 11. 統合とテスト
- [x] 11.1 システム管理者画面への統合
  - ShopsManagementコンポーネントにShopOnboardingFlowを統合
  - 新規登録ボタンからShopOnboardingFlowを開く機能
  - 登録完了後のコールバック処理
  - 店舗一覧の更新機能
  - _Requirements: 1.1_

- [x] 11.2 店舗管理者画面への統合
  - ShopManagerAppに拡張されたShopInfoEditを統合
  - 公開前ステータスの表示確認
  - 編集機能の動作確認
  - _Requirements: 11.1, 11.2, 11.3_

- [ ] 11.3 ユニットテストの実装
  - ステップ遷移ロジックのテスト
  - バリデーション関数のテスト
  - 営業時間バリデーションのテスト
  - 画像圧縮ロジックのテスト
  - 各フィールドのバリデーションロジックのテスト
  - _Requirements: All validation requirements_

- [ ] 11.4 統合テストの実装
  - 全ステップを通じた登録フローのテスト（モックAPI使用）
  - 位置情報取得フローのテスト（郵便番号検索 → 住所入力 → Geocoding API呼び出し）
  - 店舗管理者作成フローのテスト（新規店舗管理者作成 → 店舗作成）
  - 公開前確認フローのテスト（店舗作成 → 公開前確認画面表示 → 公開/下書き保存）
  - 店舗管理者編集フローのテスト（公開前店舗情報の取得 → 編集 → 保存）
  - _Requirements: All flow requirements_

- [ ] 11.5 E2Eテストの実装
  - システム管理者による店舗登録フローのテスト（新規登録ボタンクリック → 全ステップ入力 → 公開前確認 → 公開）
  - システム管理者による下書き保存フローのテスト（全ステップ入力 → 公開前確認 → 後で公開する選択）
  - 店舗管理者による公開前編集フローのテスト（ログイン → 公開前ステータス表示 → 情報編集 → 保存）
  - エラーケースのテスト（必須項目未入力、位置情報未取得、ネットワークエラー時の動作）
  - _Requirements: All user flow requirements_

