# Requirements Document

## Introduction

システム管理機能は、システム管理者がシステム全体を管理する機能を提供します。認証、ダッシュボード、店舗管理、店舗管理者アカウント管理、システム設定管理などの機能を含みます。モバイルファーストのシンプルなダッシュボードを提供し、モバイルデバイスでも快適に操作できるレスポンシブデザインを提供します。

## Requirements

### Requirement 1: システム管理者認証
**Objective:** As a システム管理者, I want 認証されたアカウントでログインできる, so that 管理画面にアクセスできる

#### Acceptance Criteria
1. WHEN システム管理者がログイン画面で認証情報を入力する場合 THEN システム SHALL 有効な認証情報の場合、ダッシュボードにアクセスを許可する
2. WHEN システム管理者がログアウトボタンをクリックする場合 THEN システム SHALL セッションを終了し、ログイン画面に戻る
3. WHEN システム管理者が無効な認証情報を入力する場合 THEN システム SHALL エラーメッセージを表示し、ログインを拒否する

### Requirement 2: ダッシュボード（モバイルファースト）
**Objective:** As a システム管理者, I want システム全体の状況を確認できる, so that モバイルファーストのシンプルなダッシュボードで統計情報を把握できる

#### Acceptance Criteria
1. WHEN システム管理者がダッシュボードにアクセスする場合 THEN システム SHALL 以下の統計情報を表示する：総店舗数、アクティブ店舗数、総店舗管理者数、アクティブ店舗管理者数
2. WHEN システム管理者がダッシュボードにアクセスする場合 THEN システム SHALL クイックアクションを表示しない（シンプルな構成）
3. WHEN システム管理者がモバイルデバイスでダッシュボードにアクセスする場合 THEN システム SHALL モバイルに最適化されたレイアウトで表示する
4. WHEN システム管理者がモバイルデバイスでダッシュボードにアクセスする場合 THEN システム SHALL 統計情報をカード形式で見やすく配置する

### Requirement 3: 店舗管理
**Objective:** As a システム管理者, I want 店舗の登録・編集・削除ができる, so that 店舗と店舗管理者の関連付けを管理できる

#### Acceptance Criteria
1. WHEN システム管理者が店舗管理画面にアクセスする場合 THEN システム SHALL 全店舗の一覧を表示する
2. WHEN システム管理者が店舗管理画面にアクセスする場合 THEN システム SHALL 各店舗に以下の情報を表示する：店舗名、住所、カテゴリ、関連付けられた店舗管理者、アクティブ状態
3. WHEN システム管理者が新しい店舗を登録する場合 THEN システム SHALL 以下の情報を入力できるようにする：店舗名、住所（郵便番号補完機能付き）、電話番号、メールアドレス、カテゴリ、緯度・経度（住所から自動取得）、店舗画像（Base64エンコード、圧縮済み）、営業時間（全曜日、日付跨ぎ対応）
4. WHEN システム管理者が新しい店舗を登録する場合 THEN システム SHALL 既存の店舗管理者を選択するか、新しい店舗管理者を作成できるようにする
5. WHEN システム管理者が新しい店舗を登録する場合 THEN システム SHALL 住所入力時にzipcloud APIによる郵便番号補完を利用できるようにする
6. WHEN システム管理者が新しい店舗を登録する場合 THEN システム SHALL 住所からGoogle Maps Geocoding APIで位置情報を自動取得する
7. WHEN システム管理者が店舗の住所を入力する場合 THEN システム SHALL 郵便番号入力時に住所の自動補完を利用できるようにする
8. WHEN システム管理者が店舗の住所を入力する場合 THEN システム SHALL 住所入力完了時にGoogle Maps Geocoding APIで位置情報を取得する
9. WHEN システム管理者が店舗の住所を入力する場合 THEN システム SHALL 正規化された住所（formatted_address）を保存する
10. WHEN システム管理者が店舗の住所を入力する場合 THEN システム SHALL Google Maps Place IDを保存する
11. WHEN システム管理者が店舗の住所を入力する場合 THEN システム SHALL Geocoding実行日時を記録する
12. WHEN システム管理者が店舗情報を編集する場合 THEN システム SHALL 店舗の基本情報を更新できるようにする
13. WHEN システム管理者が店舗情報を編集する場合 THEN システム SHALL 関連付けられた店舗管理者を変更できるようにする
14. WHEN システム管理者が店舗情報を編集する場合 THEN システム SHALL 利用可能な店舗管理者のリストを表示する
15. WHEN システム管理者が店舗を削除する場合 THEN システム SHALL 確認ダイアログを表示する
16. WHEN システム管理者が店舗を削除する場合 THEN システム SHALL 削除後は店舗を非アクティブ状態にする

### Requirement 4: 店舗管理者アカウント管理
**Objective:** As a システム管理者, I want 店舗管理者アカウントの作成・編集・削除ができる, so that 店舗管理者と店舗の1対1関係を維持できる

#### Acceptance Criteria
1. WHEN システム管理者が店舗管理者管理画面にアクセスする場合 THEN システム SHALL 全店舗管理者の一覧を表示する
2. WHEN システム管理者が店舗管理者管理画面にアクセスする場合 THEN システム SHALL 各店舗管理者に以下の情報を表示する：ユーザー名、姓名、関連付けられた店舗、アクティブ状態
3. WHEN システム管理者が新しい店舗管理者を作成する場合 THEN システム SHALL 以下の情報を入力できるようにする：ユーザー名、パスワード、姓名、関連付けられる店舗（オプション）
4. WHEN システム管理者が店舗管理者情報を編集する場合 THEN システム SHALL 基本情報を更新できるようにする
5. WHEN システム管理者が店舗管理者情報を編集する場合 THEN システム SHALL パスワードを変更できるようにする（オプション）
6. WHEN システム管理者が店舗管理者情報を編集する場合 THEN システム SHALL 関連付けられた店舗を変更できるようにする
7. WHEN システム管理者が店舗管理者を削除する場合 THEN システム SHALL 確認ダイアログを表示する
8. WHEN システム管理者が店舗管理者を削除する場合 THEN システム SHALL 削除後は店舗管理者を非アクティブ状態にする

### Requirement 5: システム設定管理（営業時間設定除外）
**Objective:** As a システム管理者, I want システム全体の設定を管理できる, so that 営業時間設定を除外した基本設定のみを変更できる

#### Acceptance Criteria
1. WHEN システム管理者がシステム設定画面にアクセスする場合 THEN システム SHALL 以下の設定項目を表示する：検索半径（メートル単位）、最大表示店舗数、自動更新間隔（秒）
2. WHEN システム管理者がシステム設定画面にアクセスする場合 THEN システム SHALL 営業時間設定を表示しない（個別店舗で管理）
3. WHEN システム管理者が設定値を変更する場合 THEN システム SHALL 変更内容をデータベースに保存する
4. WHEN システム管理者が設定値を変更する場合 THEN システム SHALL 利用者アプリの動作に即座に反映する
5. WHEN システム管理者が設定画面を表示する場合 THEN システム SHALL 「現在の設定」セクションに以下の情報を表示する：検索半径: 1000m、最大表示店舗数: 50、自動更新間隔: 30秒

### Requirement 6: モバイルファーストデザイン
**Objective:** As a システム管理者, I want モバイルデバイスでも操作できる, so that どこからでもシステム管理ができる

#### Acceptance Criteria
1. WHEN システム管理者がスマートフォンでアプリにアクセスする場合 THEN システム SHALL モバイルに最適化されたUIで操作できるようにする
2. WHEN システム管理者がスマートフォンでアプリにアクセスする場合 THEN システム SHALL フッターナビゲーションで主要機能にアクセスできるようにする
3. WHEN システム管理者がタブレットでアプリにアクセスする場合 THEN システム SHALL タブレットに最適化されたUIで操作できるようにする
4. WHEN システム管理者がタブレットでアプリにアクセスする場合 THEN システム SHALL より多くの情報を効率的に表示できるようにする
5. WHEN システム管理者が異なる画面サイズでアプリにアクセスする場合 THEN システム SHALL 画面サイズに応じて最適なレイアウトで表示する
6. WHEN システム管理者が異なる画面サイズでアプリにアクセスする場合 THEN システム SHALL フォームやテーブルが画面に収まるように調整する

### Requirement 7: アクセス権限
**Objective:** As a システム, I want システム管理者のみが管理機能にアクセスできる, so that 全店舗と全店舗管理者を管理できる

#### Acceptance Criteria
1. WHEN システム管理者が管理機能にアクセスする場合 THEN システム SHALL システム管理者権限を確認する
2. WHEN システム管理者が管理機能にアクセスする場合 THEN システム SHALL 権限がない場合はアクセスを拒否する
3. WHEN システム管理者が店舗や店舗管理者を表示する場合 THEN システム SHALL 全店舗と全店舗管理者の情報を表示する
4. WHEN システム管理者が店舗や店舗管理者を表示する場合 THEN システム SHALL 他の管理者の制限を受けない

