# Requirements Document

## Introduction

店舗管理機能は、店舗管理者が自分の店舗の情報を管理し、空き状況を更新できる機能を提供します。認証、店舗情報の編集、空き状況管理、スタッフ用アクセス管理、ダッシュボード表示などの機能を含みます。モバイルデバイスでも快適に操作できるレスポンシブデザインを提供します。

## Requirements

### Requirement 1: 店舗管理者認証
**Objective:** As a 店舗管理者, I want 認証されたアカウントでログインできる, so that ダッシュボードにアクセスできる

#### Acceptance Criteria
1. WHEN 店舗管理者がログイン画面で認証情報を入力する場合 THEN システム SHALL 有効な認証情報の場合、ダッシュボードにアクセスを許可する
2. WHEN 店舗管理者がログアウトボタンをクリックする場合 THEN システム SHALL セッションを終了し、ログイン画面に戻る
3. WHEN 店舗管理者が無効な認証情報を入力する場合 THEN システム SHALL エラーメッセージを表示し、ログインを拒否する

### Requirement 2: 店舗情報更新
**Objective:** As a 店舗管理者, I want 自分の店舗の情報を更新できる, so that 店舗情報を最新の状態に保てる

#### Acceptance Criteria
1. WHEN 店舗管理者が店舗情報編集画面にアクセスする場合 THEN システム SHALL 店舗名、住所、電話番号、営業時間、カテゴリ、店舗画像を編集できるようにする
2. WHEN 店舗管理者が店舗画像をアップロードする場合 THEN システム SHALL ファイル選択ダイアログを表示し、画像ファイルを選択できるようにする
3. WHEN 店舗管理者が店舗画像をアップロードする場合 THEN システム SHALL アップロード前に画像プレビューを表示する
4. WHEN 店舗管理者が店舗画像をアップロードする場合 THEN システム SHALL ファイルサイズと形式のバリデーションを実行する
5. WHEN 店舗管理者が画像ファイルをアップロードする場合 THEN システム SHALL クライアントサイドで画像を圧縮する
6. WHEN 画像が圧縮される場合 THEN システム SHALL 画像サイズを800x600ピクセル以下に調整する
7. WHEN 画像が圧縮される場合 THEN システム SHALL JPEG形式で品質80%で圧縮する
8. WHEN 画像が圧縮される場合 THEN システム SHALL 圧縮された画像をBase64エンコードして送信する
9. WHEN 画像が保存される場合 THEN システム SHALL データベースのTEXT型カラムに保存する
10. WHEN 店舗管理者が営業時間を設定する場合 THEN システム SHALL 各曜日ごとに営業開始時刻と終了時刻を設定できるようにする
11. WHEN 店舗管理者が営業時間を設定する場合 THEN システム SHALL 終了時刻が翌日にまたがる場合は「翌日」フラグを設定できるようにする（例：月曜日 17:00 - 火曜日 04:00（翌日））
12. WHEN 店舗管理者が変更内容を保存する場合 THEN システム SHALL 変更をデータベースに反映し、利用者画面に即座に反映する
13. WHEN 店舗管理者が必須項目を空にして保存しようとする場合 THEN システム SHALL エラーメッセージを表示し、保存を拒否する

### Requirement 3: 空き状況管理
**Objective:** As a 店舗管理者, I want リアルタイムで空き状況を更新できる, so that 利用者に最新の空き状況を提供できる

#### Acceptance Criteria
1. WHEN 店舗管理者が空き状況を「空きあり」「混雑」「満席」に変更する場合 THEN システム SHALL 利用者画面に即座に反映する
2. WHEN 店舗管理者が営業時間外に設定する場合 THEN システム SHALL 利用者画面に「営業時間外」と表示する

### Requirement 4: スタッフ用空き状況更新機能
**Objective:** As a 店舗スタッフ, I want 店舗管理者の認証なしで空き状況を更新できる, so that QRコードと4桁パスコードによる認証で簡単に更新できる

#### Acceptance Criteria
1. WHEN 店舗管理者が空き状況更新画面でQRコードを生成する場合 THEN システム SHALL 無期限のアクセストークンを含むQRコードを表示する
2. WHEN 店舗管理者が空き状況更新画面でQRコードを生成する場合 THEN システム SHALL 4桁の数字パスコードを自動生成する
3. WHEN 店舗管理者が空き状況更新画面でQRコードを生成する場合 THEN システム SHALL QRコードとパスコードを再発行可能にする
4. WHEN 店舗管理者が空き状況更新画面でQRコードを生成する場合 THEN システム SHALL QRコードに店舗固有のUUIDトークンを含める
5. WHEN 店舗管理者が空き状況更新画面でQRコードを生成する場合 THEN システム SHALL パスコードをシステムがランダムに生成する4桁数字にする
6. WHEN スタッフがQRコードを読み取り、4桁パスコードを入力する場合 THEN システム SHALL 空き状況更新画面にアクセスを許可する
7. WHEN スタッフがQRコードを読み取り、4桁パスコードを入力する場合 THEN システム SHALL ヘッダーのみのシンプルなUIで空き状況を更新できるようにする
8. WHEN スタッフがQRコードを読み取り、4桁パスコードを入力する場合 THEN システム SHALL 店舗情報の編集をできないようにする（空き状況のみ更新可能）
9. WHEN スタッフが間違ったパスコードを入力する場合 THEN システム SHALL 認証エラーを表示し、アクセスを拒否する
10. WHEN スタッフが間違ったパスコードを入力する場合 THEN システム SHALL 正しいパスコードでのみアクセスを許可する
11. WHEN 店舗管理者がQRコードを再発行する場合 THEN システム SHALL 新しいアクセストークンとパスコードを生成する
12. WHEN 店舗管理者がQRコードを再発行する場合 THEN システム SHALL 古いQRコードを無効化する
13. WHEN 店舗管理者がQRコードを再発行する場合 THEN システム SHALL 新しいQRコードを表示する

### Requirement 5: ダッシュボード（簡素化版）
**Objective:** As a 店舗管理者, I want 店舗の状況を確認できる, so that 現在の空き状況と店舗基本情報を把握できる

#### Acceptance Criteria
1. WHEN 店舗管理者がダッシュボードにアクセスする場合 THEN システム SHALL 現在の空き状況と店舗基本情報を表示する
2. WHEN 店舗管理者がダッシュボードにアクセスする場合 THEN システム SHALL クイックアクションや更新履歴を表示しない（シンプルな構成）
3. WHEN 店舗管理者がダッシュボードから各機能にアクセスする場合 THEN システム SHALL ヘッダーナビゲーションで「店舗情報編集」「空き状況更新」にアクセスできるようにする

### Requirement 6: アクセス権限
**Objective:** As a システム, I want 店舗管理者が自分の店舗のみ管理できる, so that 他の店舗の情報にアクセスできないようにする

#### Acceptance Criteria
1. WHEN 店舗管理者が他の店舗の情報にアクセスしようとする場合 THEN システム SHALL アクセスを拒否し、エラーメッセージを表示する
2. WHEN 店舗管理者が店舗一覧を表示する場合 THEN システム SHALL 自分が管理する店舗のみを表示する

### Requirement 7: レスポンシブデザイン
**Objective:** As a 店舗管理者, I want モバイルデバイスでも操作できる, so that どこからでも店舗情報を管理できる

#### Acceptance Criteria
1. WHEN 店舗管理者がスマートフォンでアプリにアクセスする場合 THEN システム SHALL モバイルに最適化されたUIで操作できるようにする
2. WHEN 店舗管理者がタブレットでアプリにアクセスする場合 THEN システム SHALL タブレットに最適化されたUIで操作できるようにする

