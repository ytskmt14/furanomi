# ふらのみ開発バックログ

## 📋 バックログについて

このバックログは、ふらのみプロジェクトの機能追加、改善、不具合修正のタスクを管理するためのものです。

### 運用ルール

1. **タスクの追加**: 新しいタスクを発見したら、適切なセクションに追加します
2. **タスクのピックアップ**: 優先度の高いタスクから選択して実装します
3. **ステータス更新**: 実装開始時に「🚧 進行中」に更新します
4. **完了時の処理**: ✅ **完了したタスクはこのバックログから削除します**
5. **履歴の追跡**: Gitコミット履歴で過去のタスクを確認できます

### 完了タスクの追跡方法

```bash
# バックログの変更履歴を確認
git log -p openspec/backlog.md

# 特定のタスクIDを検索
git log --all --grep="TASK-XXX"
```

### OpenSpec changeとの連携

- **changeが必要なタスク**: `openspec/changes/<change-id>/` にproposal、tasks、spec deltasを作成
- **changeが不要なタスク**: 直接実装してコミット

---

## 🎯 優先度別タスク一覧

### 🔴 優先度: 高（緊急対応が必要）

現時点では特になし

### 🟡 優先度: 中（近日中に対応したい）

現時点では特になし

### 🟢 優先度: 低（将来的に対応したい）

#### TASK-026: PWA更新通知UIの追加

- **カテゴリ**: Feature (PWA)
- **優先度**: 🟢 低
- **工数見積**: 中(3-5h)
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: ✅ **必要** - `changes/add-pwa-support` にタスク追加済み
- **説明**: 新しいバージョンが利用可能になったときにユーザーに通知を表示し、更新を選択できるようにする
- **実装内容**:
  - 更新通知UIコンポーネントの作成
  - 「今すぐ更新」「後で」ボタンの実装
  - 手動更新ボタンの追加（設定画面に「更新をチェック」ボタン）
- **受け入れ基準**:
  - [ ] 新しいバージョンが利用可能になったときに通知が表示される
  - [ ] 「今すぐ更新」ボタンで更新できる
  - [ ] 「後で」ボタンで通知を閉じられる
  - [ ] 設定画面から手動で更新をチェックできる
- **関連**: `openspec/changes/add-pwa-support/tasks.md` のセクション5

#### TASK-027: 利用者アプリへのアクセス解析導入（Google Analytics）

- **カテゴリ**: Feature (Analytics)
- **優先度**: 🟢 低
- **工数見積**: 小(1-2h) - まずはPVのみ
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: ✅ **必要** - プライバシーポリシーへの影響を考慮
- **説明**: Google Analytics (GA4) を利用者アプリに導入し、基本指標（ページビュー、セッション、ユーザー数）を測定できるようにする。将来的にイベントトラッキングも拡張可能な設計とする。
- **実装内容**:
  - GA4のトラッキングコード実装
  - 環境変数で測定IDを管理
  - 本番環境のみ有効化（開発環境では無効）
  - ページビュー、セッション、ユーザー数の測定
- **受け入れ基準**:
  - [ ] GA4のトラッキングコードが実装されている
  - [ ] ページビューが正しく計測される
  - [ ] セッション数が正しく計測される
  - [ ] ユーザー数が正しく計測される
  - [ ] 開発環境では無効化（本番環境のみ有効）
  - [ ] プライバシーポリシーへの影響を考慮（必要に応じてCookie同意バナー等を追加）

#### TASK-028: 店舗管理者ダッシュボードに利用者アプリカードプレビュー追加

- **カテゴリ**: Feature (UX)
- **優先度**: 🟢 低
- **工数見積**: 中(3-5h)
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: ✅ **必要** - 新規 `changes/add-shop-card-preview`
- **説明**: 店舗管理者が自分の店舗が利用者アプリでどのように表示されるかを確認できるように、ダッシュボードにプレビューセクションを追加する。
- **実装内容**:
  - ShopCardPreviewコンポーネントの作成（ShopListのカード表示ロジックを再利用）
  - ダッシュボードに「利用者アプリでの表示」セクションを追加
  - インタラクティブな要素（お気に入り、予約ボタン）は無効化または「プレビュー」表示
  - 距離情報は表示しない（店舗管理者には不要）
- **受け入れ基準**:
  - [ ] ダッシュボードに利用者アプリのカードプレビューが表示される
  - [ ] 利用者アプリと同じ見た目で店舗カードが表示される
  - [ ] 空き状況バッジが正しく表示される
  - [ ] 店舗画像、店舗名、住所、カテゴリが正しく表示される
  - [ ] インタラクティブな要素は無効化されている（クリック不可）
  - [ ] 距離情報は表示されない
  - [ ] プレビューであることが明確に分かる

#### TASK-020: 店舗管理者向けランディングページ作成

- **カテゴリ**: Feature (Marketing)
- **優先度**: 🟢 低
- **工数見積**: 大(1-2日)
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: ✅ **必要** - 新規 `changes/add-shop-manager-lp`
- **説明**: 新規店舗オーナーの募集・参加促進用ランディングページ（`/lp/shop-manager`）を作成
- **前提条件**: 料金体系FIX後に実施予定
- **作業スコープ**:
  - [ ] サービス紹介（店舗オーナー向け）
  - [ ] 参加メリット（集客向上、管理の簡単さ）
  - [ ] 導入方法（3ステップ）
  - [ ] 料金体系（FIX後）
  - [ ] 問い合わせフォーム
  - [ ] 利用者向けLPとの相互リンク
  - [ ] レスポンシブ対応
  - [ ] パフォーマンス最適化
- **受け入れ基準**:
  - [ ] 参加メリットが明確に伝わる
  - [ ] 導入方法が分かりやすい
  - [ ] 料金体系が明記されている
  - [ ] 問い合わせフォームが機能する
  - [ ] 利用者向けLPとの相互リンクが機能する
  - [ ] モバイル・デスクトップ両方で最適表示
  - [ ] Lighthouseスコア90以上
- **関連**: TASK-019（利用者向けLP）

#### TASK-009: エラーメッセージの詳細化

- **カテゴリ**: Improvement (UX)
- **優先度**: 🟢 低
- **工数見積**: 中(3-5h)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 不要
- **説明**: ユーザーに表示するエラーメッセージをより具体的で理解しやすいものにする。現在は汎用的なエラーメッセージが多い。
- **受け入れ基準**:
  - [ ] 主要なエラーケースで具体的なメッセージが表示される
  - [ ] エラーの原因と対処法が明確
  - [ ] ユーザーフレンドリーな表現

#### TASK-010: バリデーションの強化

- **カテゴリ**: Improvement (Security/UX)
- **優先度**: 🟢 低
- **工数見積**: 中(3-5h)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 不要
- **説明**: フォームのバリデーションを強化し、ユーザー入力の品質を向上させる
- **対象**:
  - メールアドレスの形式チェック
  - 電話番号の形式チェック（日本の形式）
  - パスワードの強度チェック（システム管理者）
- **受け入れ基準**:
  - [ ] メールアドレスが正しい形式かチェックされる
  - [ ] 電話番号が日本の形式かチェックされる
  - [ ] パスワードの強度が判定される
  - [ ] リアルタイムでバリデーションフィードバックが表示される

#### TASK-024: 店舗管理者向けパスワードリセット機能

- **カテゴリ**: Feature (Security)
- **優先度**: 🟡 中
- **工数見積**: 中(3-5h)
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: 不要（軽微な機能追加）
- **説明**: 店舗管理者がパスワードを忘れた場合に、自分でパスワードをリセットできる機能を追加
- **実装内容**:
  - メールアドレス入力フォーム
  - リセットトークン生成・送信
  - パスワードリセット用リンク（メール）
  - 新しいパスワード設定画面
  - システム管理者向けパスワードリセット機能（管理者は任意にリセット可能）
- **受け入れ基準**:
  - [ ] メールアドレスでリセットリクエストができる
  - [ ] リセットトークンがメールで送信される
  - [ ] トークンを使って新しいパスワードを設定できる
  - [ ] トークンは1回限り有効で期限付き
  - [ ] システム管理者は任意の店舗管理者のパスワードをリセットできる
- **関連**: TASK-009（エラーメッセージ改善）

#### TASK-012: タップ領域のサイズ最適化

- **カテゴリ**: Improvement (Mobile UX)
- **優先度**: 🟢 低
- **工数見積**: 小(1-2h)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 不要
- **説明**: モバイルでのタップ操作を最適化。タップ領域が小さすぎる箇所を修正（推奨: 最小44x44px）
- **受け入れ基準**:
  - [ ] 全てのボタンが最小44x44pxのタップ領域を持つ
  - [ ] リンクやアイコンボタンも適切なサイズ
  - [ ] モバイルでの操作性が向上

---

## 📦 カテゴリ別タスク一覧

### 🐛 不具合修正（Bugs）

（該当なし）

### 🎨 UX/UI改善（Improvements）

- TASK-009: エラーメッセージの詳細化
- TASK-010: バリデーションの強化
- TASK-011: タップ領域のサイズ最適化

### ⚡ パフォーマンス改善（Performance）

現時点では特になし

### 🔒 セキュリティ強化（Security）

- TASK-024: 店舗管理者向けパスワードリセット機能
- TASK-015: セキュリティ強化（CSRF、XSS対策、レート制限）

### ✨ 新機能（Features）

- TASK-012: リアルタイム更新機能（WebSocket/SSE）
- TASK-026: PWA更新通知UIの追加
- TASK-027: 利用者アプリへのアクセス解析導入（Google Analytics）
- TASK-028: 店舗管理者ダッシュボードに利用者アプリカードプレビュー追加

### 📝 ドキュメント（Documentation）

現時点では特になし

### 🧪 テスト（Testing）

- TASK-014: 包括的なテスト実装（単体・統合・E2E）

### 🔧 DevOps

- TASK-017: 運用監視（ログ監視、バックアップ、アラート）

---

## ⏭️ Phase 2 - 将来実装予定

### TASK-012: リアルタイム更新機能（WebSocket/SSE）

- **カテゴリ**: Feature
- **優先度**: Phase 3（Phase 2から延期）
- **工数見積**: 特大(3日+)
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: 必要
- **説明**: WebSocketまたはSSEを使用して、空き状況の変更をリアルタイムで利用者アプリに反映する。Phase 2ではプッシュ通知で代替するため、優先度を下げてPhase 3に延期。
- **受け入れ基準**:
  - [ ] WebSocket/SSE接続が確立される
  - [ ] 空き状況の変更がリアルタイムで通知される
  - [ ] 接続が切れた場合の再接続処理
  - [ ] パフォーマンスへの影響が最小限

### TASK-014: 包括的なテスト実装（単体・統合・E2E）

- **カテゴリ**: Testing
- **優先度**: Phase 3
- **工数見積**: 特大(3日+)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 不要
- **説明**: コード品質と保守性を向上させるため、包括的なテストスイートを実装
- **対象**:
  - ユニットテスト（Jest）
  - 統合テスト（React Testing Library）
  - E2Eテスト（Playwright/Cypress）
- **受け入れ基準**:
  - [ ] カバレッジ80%以上
  - [ ] CI/CDパイプラインに統合
  - [ ] 主要なユーザーフローがE2Eでカバーされている

### TASK-015: セキュリティ強化（CSRF、XSS対策、レート制限）

- **カテゴリ**: Security
- **優先度**: Phase 3
- **工数見積**: 大(1-2日)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 必要
- **説明**: セキュリティ対策を強化し、本番環境での安全性を向上させる
- **対象**:
  - CSRF対策の強化
  - XSS対策の強化
  - レート制限の実装
  - セキュリティヘッダーの追加
- **受け入れ基準**:
  - [ ] CSRF トークンが実装されている
  - [ ] XSS対策が施されている
  - [ ] API呼び出しにレート制限がある
  - [ ] セキュリティスキャンをパス

### TASK-016: パフォーマンス最適化（バンドル最適化、キャッシュ戦略）

- **カテゴリ**: Performance
- **優先度**: Phase 3
- **工数見積**: 中(3-5h)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 不要
- **説明**: アプリケーションのパフォーマンスを最適化し、読み込み速度を向上させる
- **対象**:
  - バンドルサイズの削減
  - 画像の最適化
  - キャッシュ戦略の改善
  - コード分割
- **受け入れ基準**:
  - [ ] バンドルサイズが20%以上削減
  - [ ] Lighthouse スコア90以上
  - [ ] 初期表示が2秒以内

### TASK-017: 運用監視（ログ監視、バックアップ、アラート）

- **カテゴリ**: DevOps
- **優先度**: Phase 3
- **工数見積**: 特大(3日+)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 必要
- **説明**: 本番環境の運用を安定化させるため、監視とバックアップ体制を構築
- **対象**:
  - ログ監視システム（Sentry等）
  - データベースバックアップ
  - アラート通知
  - ヘルスチェック
- **受け入れ基準**:
  - [ ] エラーログが自動的に収集される
  - [ ] 日次バックアップが設定されている
  - [ ] 重大なエラー時にアラートが飛ぶ
  - [ ] ダッシュボードで状態を監視できる

---

## 📝 タスクフォーマット（新規追加時のテンプレート）

新しいタスクを追加する際は、以下のフォーマットを使用してください：

```markdown
### TASK-XXX: タスク名

- **カテゴリ**: Bug / Improvement / Feature / Performance / Security / Documentation / Testing / DevOps
- **優先度**: 🔴 高 / 🟡 中 / 🟢 低
- **工数見積**: 小(1-2h) / 中(3-5h) / 大(1-2日) / 特大(3日+)
- **ステータス**: 🚧 進行中 / 🚧 進行中
- **OpenSpec Change**: 必要 / 不要
- **説明**: タスクの詳細説明
- **受け入れ基準**:
  - [ ] 基準1
  - [ ] 基準2
  - [ ] 基準3
- **関連**: 関連するタスクやissue（オプション）
```

---

## 🔄 開発フロー

### 1. タスクのピックアップ

```
1. このバックログから優先度の高いタスクを選択
2. ステータスを「🚧 進行中」に更新
3. OpenSpec changeが必要か確認
```

### 2. 実装

```
OpenSpec changeが必要な場合:
  1. openspec/changes/<change-id>/ を作成
  2. proposal.md, tasks.md, spec deltas を作成
  3. 実装
  4. デプロイ
  5. archiveに移動

OpenSpec changeが不要な場合:
  1. コード修正
  2. テスト
  3. コミット（"fix:", "improve:", "feat:" 等）
  4. デプロイ
```

### 3. 完了処理

```
✅ タスク完了時:
  1. このバックログから該当タスクを削除
  2. Gitコミットメッセージに記載
     例: "improve: TASK-001 スタッフ画面のalert()をトースト通知に置き換え"
  3. OpenSpec changeを作成していた場合はarchive
```

---

## 📚 参考情報

- **OpenSpec開発フロー**: [openspec/AGENTS.md](./AGENTS.md)
- **プロジェクト概要**: [README.md](../README.md)
- **仕様書**: [openspec/specs/](./specs/)
- **完了した変更**: [openspec/changes/archive/](./changes/archive/)

---

**最終更新**: 2025年10月31日

