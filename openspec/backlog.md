# ふらのみ開発バックログ

## 📋 バックログについて

このバックログは、ふらのみプロジェクトの機能追加、改善、不具合修正のタスクを管理するためのものです。

### 運用ルール

1. **タスクの追加**: 新しいタスクを発見したら、適切なセクションに追加します
2. **タスクのピックアップ**: 優先度の高いタスクから選択して実装します
3. **ステータス更新**: 実装開始時に「🚧 進行中」に更新します
4. **完了時の処理**: ✅ **完了したタスクはこのバックログから削除します**
5. **履歴の追跡**: Gitコミット履歴で過去のタスクを確認できます

### 完了タスクの追跡方法

```bash
# バックログの変更履歴を確認
git log -p openspec/backlog.md

# 特定のタスクIDを検索
git log --all --grep="TASK-XXX"
```

### OpenSpec changeとの連携

- **changeが必要なタスク**: `openspec/changes/<change-id>/` にproposal、tasks、spec deltasを作成
- **changeが不要なタスク**: 直接実装してコミット

---

## 🎯 優先度別タスク一覧

### 🔴 優先度: 高（緊急対応が必要）

現時点では特になし

### 🟡 優先度: 中（近日中に対応したい）

現時点では特になし

### 🟢 優先度: 低（将来的に対応したい）

#### TASK-020: 店舗管理者向けランディングページ作成

- **カテゴリ**: Feature (Marketing)
- **優先度**: 🟢 低
- **工数見積**: 大(1-2日)
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: ✅ **必要** - 新規 `changes/add-shop-manager-lp`
- **説明**: 新規店舗オーナーの募集・参加促進用ランディングページ（`/lp/shop-manager`）を作成
- **前提条件**: 料金体系FIX後に実施予定
- **作業スコープ**:
  - [ ] サービス紹介（店舗オーナー向け）
  - [ ] 参加メリット（集客向上、管理の簡単さ）
  - [ ] 導入方法（3ステップ）
  - [ ] 料金体系（FIX後）
  - [ ] 問い合わせフォーム
  - [ ] 利用者向けLPとの相互リンク
  - [ ] レスポンシブ対応
  - [ ] パフォーマンス最適化
- **受け入れ基準**:
  - [ ] 参加メリットが明確に伝わる
  - [ ] 導入方法が分かりやすい
  - [ ] 料金体系が明記されている
  - [ ] 問い合わせフォームが機能する
  - [ ] 利用者向けLPとの相互リンクが機能する
  - [ ] モバイル・デスクトップ両方で最適表示
  - [ ] Lighthouseスコア90以上
- **関連**: TASK-019（利用者向けLP）

#### TASK-018: ふらのみロゴ作成とアプリ反映 ✅

- **カテゴリ**: Improvement (Branding/UX)
- **優先度**: 🟢 低
- **工数見積**: 中(3-5h)
- **ステータス**: ✅ 完了
- **OpenSpec Change**: 不要
- **説明**: ふらのみアプリのブランドアイデンティティを強化するため、オリジナルロゴを作成し、全アプリ（ユーザーアプリ、店舗管理者アプリ、システム管理者アプリ）に反映する
- **作業スコープ**:
  - [x] ロゴデザインのコンセプト検討
  - [x] SVG形式でのロゴ作成
  - [x] 複数サイズ（16x16, 32x32, 64x64, 128x128, 256x256）の生成
  - [x] ファビコン（.ico, .png）の作成
  - [x] ユーザーアプリへの反映（ヘッダー、タブタイトル、PWAアイコン）
  - [x] 店舗管理者アプリへの反映（ヘッダー、タブタイトル）
  - [x] システム管理者アプリへの反映（ヘッダー、タブタイトル）
  - [x] レスポンシブ対応（モバイル・デスクトップ）
- **受け入れ基準**:
  - [x] オリジナルロゴが作成されている
  - [x] 全アプリのヘッダーにロゴが表示される
  - [x] ブラウザタブにファビコンが表示される
  - [x] PWAアイコンとして適切に表示される
  - [x] モバイル・デスクトップ両方で適切に表示される
  - [x] ロゴの品質が高く、ブランドイメージに合致している
- **実装詳細**:
  - カクテルシェーカー + 位置情報をモチーフにしたデザイン
  - ブルー系カラーパレット（#3B82F6, #1E40AF, #FEF3C7）
  - SVG形式で作成、複数サイズ対応
  - 全アプリのヘッダーに統一ロゴを配置
  - レスポンシブ対応（モバイル: w-6 h-6, デスクトップ: w-8 h-8）

#### TASK-009: エラーメッセージの詳細化

- **カテゴリ**: Improvement (UX)
- **優先度**: 🟢 低
- **工数見積**: 中(3-5h)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 不要
- **説明**: ユーザーに表示するエラーメッセージをより具体的で理解しやすいものにする。現在は汎用的なエラーメッセージが多い。
- **受け入れ基準**:
  - [ ] 主要なエラーケースで具体的なメッセージが表示される
  - [ ] エラーの原因と対処法が明確
  - [ ] ユーザーフレンドリーな表現

#### TASK-010: バリデーションの強化

- **カテゴリ**: Improvement (Security/UX)
- **優先度**: 🟢 低
- **工数見積**: 中(3-5h)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 不要
- **説明**: フォームのバリデーションを強化し、ユーザー入力の品質を向上させる
- **対象**:
  - メールアドレスの形式チェック
  - 電話番号の形式チェック（日本の形式）
  - パスワードの強度チェック（システム管理者）
- **受け入れ基準**:
  - [ ] メールアドレスが正しい形式かチェックされる
  - [ ] 電話番号が日本の形式かチェックされる
  - [ ] パスワードの強度が判定される
  - [ ] リアルタイムでバリデーションフィードバックが表示される

#### TASK-024: 店舗管理者向けパスワードリセット機能

- **カテゴリ**: Feature (Security)
- **優先度**: 🟡 中
- **工数見積**: 中(3-5h)
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: 不要（軽微な機能追加）
- **説明**: 店舗管理者がパスワードを忘れた場合に、自分でパスワードをリセットできる機能を追加
- **実装内容**:
  - メールアドレス入力フォーム
  - リセットトークン生成・送信
  - パスワードリセット用リンク（メール）
  - 新しいパスワード設定画面
  - システム管理者向けパスワードリセット機能（管理者は任意にリセット可能）
- **受け入れ基準**:
  - [ ] メールアドレスでリセットリクエストができる
  - [ ] リセットトークンがメールで送信される
  - [ ] トークンを使って新しいパスワードを設定できる
  - [ ] トークンは1回限り有効で期限付き
  - [ ] システム管理者は任意の店舗管理者のパスワードをリセットできる
- **関連**: TASK-009（エラーメッセージ改善）

#### TASK-012: タップ領域のサイズ最適化

- **カテゴリ**: Improvement (Mobile UX)
- **優先度**: 🟢 低
- **工数見積**: 小(1-2h)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 不要
- **説明**: モバイルでのタップ操作を最適化。タップ領域が小さすぎる箇所を修正（推奨: 最小44x44px）
- **受け入れ基準**:
  - [ ] 全てのボタンが最小44x44pxのタップ領域を持つ
  - [ ] リンクやアイコンボタンも適切なサイズ
  - [ ] モバイルでの操作性が向上

---

## 📦 カテゴリ別タスク一覧

### 🐛 不具合修正（Bugs）

（該当なし）

### 🎨 UX/UI改善（Improvements）

- TASK-009: エラーメッセージの詳細化
- TASK-010: バリデーションの強化
- TASK-011: タップ領域のサイズ最適化

### ⚡ パフォーマンス改善（Performance）

現時点では特になし

### 🔒 セキュリティ強化（Security）

- TASK-024: 店舗管理者向けパスワードリセット機能
- TASK-015: セキュリティ強化（CSRF、XSS対策、レート制限）

### ✨ 新機能（Features）

- TASK-022: 利用者認証機能の実装
- TASK-023: 予約機能の追加
- TASK-025: お気に入り店舗登録機能
- TASK-026: プッシュ通知の個別設定機能
- TASK-027: 来店履歴・チェックイン機能
- TASK-012: リアルタイム更新機能（WebSocket/SSE）
- TASK-013: PWA対応（オフライン機能、プッシュ通知）

### 📝 ドキュメント（Documentation）

現時点では特になし

### 🧪 テスト（Testing）

- TASK-014: 包括的なテスト実装（単体・統合・E2E）

### 🔧 DevOps

- TASK-017: 運用監視（ログ監視、バックアップ、アラート）

---

## ⏭️ Phase 2 - 将来実装予定

### TASK-022: 利用者認証機能の実装

- **カテゴリ**: Feature (Authentication)
- **優先度**: Phase 2
- **工数見積**: 大(1-2日)
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: ✅ **必要** - 新規 `changes/add-user-authentication`
- **説明**: 利用者がログイン・登録できる認証機能を実装。予約機能の前提条件。
- **実装内容**:
  - ユーザー登録（メールアドレス・パスワード）
  - ログイン・ログアウト機能
  - セッション管理（JWT）
  - パスワードリセット機能
  - プロフィール管理
- **データベース**:
  - `users`テーブル作成（id, email, password_hash, name, phone, created_at, updated_at）
  - セッション管理
- **受け入れ基準**:
  - [ ] ユーザー登録ができる
  - [ ] ログイン・ログアウトができる
  - [ ] パスワードのハッシュ化が実装されている
  - [ ] セッション管理が機能する
  - [ ] パスワードリセットができる
- **関連**: TASK-023（予約機能の前提条件）

### TASK-023: 予約機能の追加

- **カテゴリ**: Feature (Reservation)
- **優先度**: Phase 2
- **工数見積**: 特大(3日+)
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: ✅ **必要** - 新規 `changes/add-reservation-system`
- **説明**: 利用者が店舗を予約できる機能を実装。認証済み利用者のみが予約可能。
- **実装内容**:
  - 予約作成（名前、人数、何分後の3段階選択）
  - 何分後の選択肢：15分以内/30分以内/1時間以内
  - 予約確認・キャンセル機能
  - 店舗管理者向け予約管理画面
  - 予約通知（メール）
- **データベース**:
  - `reservations`テーブル作成（id, user_id, shop_id, name, party_size, arrival_time_estimate, status, created_at, updated_at）
- **受け入れ基準**:
  - [ ] 認証済み利用者が予約できる
  - [ ] 予約情報（名前、人数、何分後）を入力できる
  - [ ] 予約の確認・キャンセルができる
  - [ ] 店舗管理者が予約一覧を確認できる
  - [ ] 予約時にメール通知が送信される
- **前提条件**: TASK-022（利用者認証機能）完了後
- **関連**: TASK-022（利用者認証機能）

### TASK-025: お気に入り店舗登録機能

- **カテゴリ**: Feature (User Experience)
- **優先度**: Phase 未確定
- **工数見積**: 中(3-5h)
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: ✅ **必要** - 新規 `changes/add-favorite-shops`
- **説明**: 会員がよく行く店舗をお気に入り登録し、素早くアクセスできる機能を実装
- **実装内容**:
  - お気に入りボタン（ハートアイコン）の追加
  - お気に入り店舗一覧表示
  - お気に入り店舗の優先表示
  - お気に入り専用タブ
- **データベース**:
  - `favorite_shops`テーブル作成（id, user_id, shop_id, created_at）
- **受け入れ基準**:
  - [ ] 店舗詳細画面でお気に入り登録/解除ができる
  - [ ] お気に入り店舗の一覧が表示される
  - [ ] お気に入り店舗が検索結果の上位に表示される
  - [ ] お気に入り状態がリアルタイムで反映される
- **前提条件**: TASK-022（利用者認証機能）完了後
- **関連**: TASK-022（利用者認証機能）、TASK-026（通知個別設定）

### TASK-026: プッシュ通知の個別設定機能

- **カテゴリ**: Feature (Notification)
- **優先度**: Phase 未確定
- **工数見積**: 中(3-5h)
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: ✅ **必要** - 新規 `changes/add-notification-preferences`
- **説明**: お気に入り店舗のみ通知を受け取るなど、プッシュ通知を個別に設定できる機能を実装
- **実装内容**:
  - 通知設定画面の追加
  - お気に入り店舗のみ通知ON/OFF
  - 店舗ごとの通知ON/OFF
  - 通知する時間帯の設定
  - 通知する状態の選択（空きあり、混雑中など）
- **データベース**:
  - `notification_preferences`テーブル作成（id, user_id, shop_id, enabled, notify_status, time_range）
  - `push_subscriptions`テーブル拡張
- **受け入れ基準**:
  - [ ] 通知設定画面が実装されている
  - [ ] お気に入り店舗のみ通知する設定ができる
  - [ ] 店舗ごとに通知ON/OFFを切り替えられる
  - [ ] 設定に従って通知が送信される
  - [ ] 通知時間帯の制限が機能する
- **前提条件**: TASK-013（PWA対応）、TASK-022（利用者認証機能）、TASK-025（お気に入り店舗）完了後
- **関連**: TASK-013（プッシュ通知基本機能）、TASK-025（お気に入り店舗）

### TASK-027: 来店履歴・チェックイン機能

- **カテゴリ**: Feature (User Experience)
- **優先度**: Phase 未確定
- **工数見積**: 大(1-2日)
- **ステータス**: 🆕 未着手
- **OpenSpec Change**: ✅ **必要** - 新規 `changes/add-visit-history`
- **説明**: 会員が訪れた店舗を記録し、来店履歴を振り返ることができる機能を実装
- **実装内容**:
  - チェックインボタンの追加
  - 来店履歴一覧表示
  - 店舗ごとの来店回数・初回訪問日表示
  - 「行ったことのある店舗」タブ
  - 来店日時のカレンダー表示
- **データベース**:
  - `visit_history`テーブル作成（id, user_id, shop_id, visited_at, check_in_method）
- **受け入れ基準**:
  - [ ] 店舗詳細画面でチェックインができる
  - [ ] 来店履歴が時系列で表示される
  - [ ] 店舗ごとの来店回数が表示される
  - [ ] 「行ったことのある店舗」タブで履歴がある店舗を一覧表示
  - [ ] カレンダー形式で来店履歴を確認できる
- **前提条件**: TASK-022（利用者認証機能）完了後
- **関連**: TASK-022（利用者認証機能）

### TASK-012: リアルタイム更新機能（WebSocket/SSE）

- **カテゴリ**: Feature
- **優先度**: Phase 2
- **工数見積**: 特大(3日+)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 必要
- **説明**: WebSocketまたはSSEを使用して、空き状況の変更をリアルタイムで利用者アプリに反映する
- **受け入れ基準**:
  - [ ] WebSocket/SSE接続が確立される
  - [ ] 空き状況の変更がリアルタイムで通知される
  - [ ] 接続が切れた場合の再接続処理
  - [ ] パフォーマンスへの影響が最小限

### TASK-013: PWA対応（オフライン機能、プッシュ通知）

- **カテゴリ**: Feature
- **優先度**: Phase 2
- **工数見積**: 大(1-2日)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: ✅ **必要** - `changes/add-pwa-support`
- **説明**: Progressive Web Appとして、オフライン機能とプッシュ通知を実装。利用者向けアプリにPWA機能を追加。
- **実装内容**:
  - Web App Manifest（manifest.json）作成
  - Service Worker実装
  - オフラインキャッシュ戦略（店舗一覧・詳細表示のみ）
  - プッシュ通知機能（空き状況変更通知）
  - ホーム画面追加対応（iOS・Android）
- **受け入れ基準**:
  - [x] Service Workerが実装されている
  - [x] manifest.jsonが設定されている
  - [x] オフラインで店舗一覧・詳細表示ができる
  - [x] 利用者向けのホーム画面に追加できる
  - [ ] 空き状況変更時にプッシュ通知が送信される（実装済み、Phase 2リリース待ち）
  - [x] アイコンファイルが適切に設定されている
- **対象**:
  - 利用者向けアプリ（`/user/*`）
- **前提条件**: なし
- **作業ブランチ**: `feature/add-push-notification`

### TASK-014: 包括的なテスト実装（単体・統合・E2E）

- **カテゴリ**: Testing
- **優先度**: Phase 3
- **工数見積**: 特大(3日+)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 不要
- **説明**: コード品質と保守性を向上させるため、包括的なテストスイートを実装
- **対象**:
  - ユニットテスト（Jest）
  - 統合テスト（React Testing Library）
  - E2Eテスト（Playwright/Cypress）
- **受け入れ基準**:
  - [ ] カバレッジ80%以上
  - [ ] CI/CDパイプラインに統合
  - [ ] 主要なユーザーフローがE2Eでカバーされている

### TASK-015: セキュリティ強化（CSRF、XSS対策、レート制限）

- **カテゴリ**: Security
- **優先度**: Phase 3
- **工数見積**: 大(1-2日)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 必要
- **説明**: セキュリティ対策を強化し、本番環境での安全性を向上させる
- **対象**:
  - CSRF対策の強化
  - XSS対策の強化
  - レート制限の実装
  - セキュリティヘッダーの追加
- **受け入れ基準**:
  - [ ] CSRF トークンが実装されている
  - [ ] XSS対策が施されている
  - [ ] API呼び出しにレート制限がある
  - [ ] セキュリティスキャンをパス

### TASK-016: パフォーマンス最適化（バンドル最適化、キャッシュ戦略）

- **カテゴリ**: Performance
- **優先度**: Phase 3
- **工数見積**: 中(3-5h)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 不要
- **説明**: アプリケーションのパフォーマンスを最適化し、読み込み速度を向上させる
- **対象**:
  - バンドルサイズの削減
  - 画像の最適化
  - キャッシュ戦略の改善
  - コード分割
- **受け入れ基準**:
  - [ ] バンドルサイズが20%以上削減
  - [ ] Lighthouse スコア90以上
  - [ ] 初期表示が2秒以内

### TASK-017: 運用監視（ログ監視、バックアップ、アラート）

- **カテゴリ**: DevOps
- **優先度**: Phase 3
- **工数見積**: 特大(3日+)
- **ステータス**: 🚧 進行中
- **OpenSpec Change**: 必要
- **説明**: 本番環境の運用を安定化させるため、監視とバックアップ体制を構築
- **対象**:
  - ログ監視システム（Sentry等）
  - データベースバックアップ
  - アラート通知
  - ヘルスチェック
- **受け入れ基準**:
  - [ ] エラーログが自動的に収集される
  - [ ] 日次バックアップが設定されている
  - [ ] 重大なエラー時にアラートが飛ぶ
  - [ ] ダッシュボードで状態を監視できる

---

## 📝 タスクフォーマット（新規追加時のテンプレート）

新しいタスクを追加する際は、以下のフォーマットを使用してください：

```markdown
### TASK-XXX: タスク名

- **カテゴリ**: Bug / Improvement / Feature / Performance / Security / Documentation / Testing / DevOps
- **優先度**: 🔴 高 / 🟡 中 / 🟢 低
- **工数見積**: 小(1-2h) / 中(3-5h) / 大(1-2日) / 特大(3日+)
- **ステータス**: 🚧 進行中 / 🚧 進行中
- **OpenSpec Change**: 必要 / 不要
- **説明**: タスクの詳細説明
- **受け入れ基準**:
  - [ ] 基準1
  - [ ] 基準2
  - [ ] 基準3
- **関連**: 関連するタスクやissue（オプション）
```

---

## 🔄 開発フロー

### 1. タスクのピックアップ

```
1. このバックログから優先度の高いタスクを選択
2. ステータスを「🚧 進行中」に更新
3. OpenSpec changeが必要か確認
```

### 2. 実装

```
OpenSpec changeが必要な場合:
  1. openspec/changes/<change-id>/ を作成
  2. proposal.md, tasks.md, spec deltas を作成
  3. 実装
  4. デプロイ
  5. archiveに移動

OpenSpec changeが不要な場合:
  1. コード修正
  2. テスト
  3. コミット（"fix:", "improve:", "feat:" 等）
  4. デプロイ
```

### 3. 完了処理

```
✅ タスク完了時:
  1. このバックログから該当タスクを削除
  2. Gitコミットメッセージに記載
     例: "improve: TASK-001 スタッフ画面のalert()をトースト通知に置き換え"
  3. OpenSpec changeを作成していた場合はarchive
```

---

## 📚 参考情報

- **OpenSpec開発フロー**: [openspec/AGENTS.md](./AGENTS.md)
- **プロジェクト概要**: [README.md](../README.md)
- **仕様書**: [openspec/specs/](./specs/)
- **完了した変更**: [openspec/changes/archive/](./changes/archive/)

---

**最終更新**: 2025年10月24日

