# PWA Specification

## Purpose
Progressive Web App（PWA）機能を提供し、オフライン環境でも店舗情報を確認でき、空き状況の変更をプッシュ通知で受け取れる体験を提供する。

## Requirements

### Requirement: Web App Manifest
システム SHALL Web App Manifestを提供し、ホーム画面への追加を可能にする。

#### Scenario: manifest.json設定
- **WHEN** 利用者がアプリにアクセスする
- **THEN** manifest.jsonが正しく設定されている
- **AND** アプリ名、ショートカット名、アイコンが設定されている
- **AND** 表示モードは「standalone」（全画面表示）

#### Scenario: アイコン設定
- **WHEN** manifest.jsonが読み込まれる
- **THEN** 以下のアイコンサイズが設定されている：
  - 48x48px
  - 72x72px
  - 96x96px
  - 144x144px
  - 192x192px
  - 512x512px

#### Scenario: ホーム画面への追加
- **WHEN** 利用者が「ホーム画面に追加」を実行する
- **THEN** iOS・Androidの両方でアイコンが表示される
- **AND** 起動時にスタンドアロンモードで表示される

### Requirement: Service Worker実装
システム SHALL Service Workerを実装し、リソースをキャッシュしてオフライン機能を提供する。

#### Scenario: Service Worker登録
- **WHEN** アプリが初回読み込みされる
- **THEN** Service Workerが自動的に登録される
- **AND** キャッシュ戦略が適用される

#### Scenario: 静的リソースのキャッシュ
- **WHEN** アプリが読み込まれる
- **THEN** 以下のリソースがキャッシュされる：
  - HTMLファイル
  - CSSファイル
  - JavaScriptファイル
  - アイコンファイル

#### Scenario: 店舗データのキャッシュ
- **WHEN** 利用者が店舗一覧を取得する
- **THEN** 店舗データがキャッシュされる
- **AND** オフライン時にもキャッシュされたデータが表示される

### Requirement: オフライン機能
システム SHALL オフライン環境でも店舗一覧・詳細表示が可能である。

#### Scenario: オフラインで店舗一覧表示
- **WHEN** 利用者がオフライン環境でアプリにアクセスする
- **THEN** キャッシュされた店舗一覧が表示される
- **AND** 「オフラインです」というメッセージが表示される

#### Scenario: オフラインで店舗詳細表示
- **WHEN** 利用者がオフライン環境で店舗詳細を見る
- **THEN** キャッシュされた店舗詳細情報が表示される
- **AND** 空き状況は最新のキャッシュデータが表示される

### Requirement: プッシュ通知
システム SHALL 空き状況の変更時にプッシュ通知を送信する。

#### Scenario: 通知許可
- **WHEN** 利用者が通知設定を有効にする
- **THEN** ブラウザの通知許可ダイアログが表示される
- **AND** 許可すると通知が受け取れる

#### Scenario: 空き状況変更通知
- **WHEN** 店舗の空き状況が変更される
- **AND** 利用者が該当店舗を観察中である
- **THEN** プッシュ通知が送信される
- **AND** 通知に店舗名と新しい空き状況が表示される

#### Scenario: 通知クリック時の動作
- **WHEN** 利用者がプッシュ通知をクリックする
- **THEN** アプリが開かれる
- **AND** 該当店舗の詳細画面が表示される

### Requirement: オフラインインジケーター
システム SHALL 利用者にオフライン状態であることを明示する。

#### Scenario: オフライン状態の表示
- **WHEN** 利用者がアプリを使用中にオフラインになる
- **THEN** 「オフラインです」というバッジまたはメッセージが表示される
- **AND** キャッシュされたデータが表示される

#### Scenario: オンライン復帰
- **WHEN** 利用者がオンラインに復帰する
- **THEN** 最新データの取得が試行される
- **AND** オフラインインジケーターが非表示になる

### Requirement: キャッシュ更新戦略
システム SHALL キャッシュされたデータを適切に更新する。

#### Scenario: キャッシュの更新
- **WHEN** 利用者がアプリを使用する
- **THEN** オフライン時はキャッシュを表示し、オンライン時は最新データを取得する
- **AND** オンライン時に最新データでキャッシュを更新する

#### Scenario: バージョン管理
- **WHEN** アプリの新しいバージョンがデプロイされる
- **THEN** Service Workerが新しいバージョンを検出する
- **AND** キャッシュをクリアして新しいバージョンをロードする

