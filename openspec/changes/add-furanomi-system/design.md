# ふらのみ Webアプリケーション設計

## Context

「ふらのみ」は、利用者が現在地から近いお店の空き状況を確認できるWebアプリケーションです。スモールスタートの方針に従い、段階的に機能を拡張していく設計とします。

## Goals / Non-Goals

### Goals
- 利用者が簡単に近くの店舗と空き状況を確認できる
- 店舗管理者がリアルタイムで空き状況を更新できる
- PWA対応でネイティブアプリライクな体験を提供
- スケーラブルなアーキテクチャで将来の機能拡張に対応

### Non-Goals
- 初期段階での予約機能（フェーズ2で検討）
- 決済機能（将来の拡張で検討）
- 複雑な分析機能（フェーズ2以降で検討）

## Decisions

### Decision: Webアプリケーション（PWA）を採用
- **理由**: スモールスタートに最適、クロスプラットフォーム対応、開発・保守コストの削減
- **代替案**: ネイティブアプリ（iOS/Android）
- **選択理由**: 開発速度とコスト効率を重視

### Decision: React + TypeScript + Node.js + PostgreSQLスタック
- **理由**: 型安全性、開発効率、スケーラビリティのバランス
- **代替案**: Vue.js + Python + MongoDB
- **選択理由**: チームの習熟度とエコシステムの充実度

### Decision: Google Maps APIを使用
- **理由**: 高品質な地図表示、位置情報サービス、豊富な機能
- **代替案**: Mapbox、Apple Maps
- **選択理由**: 信頼性と機能の充実度

### Decision: JWT認証 + HTTP-only cookies
- **理由**: セキュリティと使いやすさのバランス
- **代替案**: Session-based認証、OAuth
- **選択理由**: 実装の簡素化とセキュリティの確保

## Risks / Trade-offs

### Risk: リアルタイム更新のパフォーマンス
- **影響**: 多数の店舗が同時に更新した場合のレスポンス低下
- **対策**: WebSocketまたはServer-Sent Eventsで効率的な更新、キャッシュ戦略の実装

### Risk: 位置情報のプライバシー
- **影響**: ユーザーの位置情報漏洩リスク
- **対策**: 最小限の位置情報収集、暗号化、ユーザー同意の明確化

### Risk: Google Maps APIの利用制限
- **影響**: API使用量制限によるサービス停止
- **対策**: 使用量監視、キャッシュ戦略、代替地図サービスの準備

## Migration Plan

### Phase 1: MVP開発
1. 基本的な店舗検索・表示機能
2. 店舗管理者の空き状況更新機能
3. システム管理者の店舗管理機能

### Phase 2: 機能拡張
1. 利用者の会員登録・ログイン機能
2. 予約システム
3. 通知機能

### Rollback Plan
- データベースのバックアップ機能
- 機能フラグによる段階的リリース
- 旧バージョンへの迅速な切り戻し機能

## Open Questions

- 店舗の空き状況の更新頻度はどの程度が適切か？
- 利用者の位置情報はどの程度の精度が必要か？
- 将来的な決済機能統合時のアーキテクチャ変更は？
- 多言語対応（英語、中国語など）の必要性は？
