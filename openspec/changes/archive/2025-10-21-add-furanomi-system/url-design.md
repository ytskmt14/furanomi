# ふらのみ Webアプリケーション URL設計

## アプリケーション構成

### 1. 利用者用アプリ (`/user/*`) **← ルート表示（デフォルト）**
**目的**: 一般ユーザーが店舗を検索・確認する

#### メイン画面
- `/user` - 店舗検索・一覧表示（デフォルト）
- `/user/search` - 検索画面（将来実装）
- `/user/map` - 地図表示（将来実装）
- `/user/shop/:id` - 店舗詳細（モーダルでも表示）

#### 機能別URL
- `/user/shop/:id/details` - 店舗詳細ページ（将来実装）
- `/user/shop/:id/map` - 店舗位置の地図表示（将来実装）

#### 現在実装済み機能
- ✅ 店舗一覧表示（リスト・地図切り替え）
- ✅ 検索モーダル（カテゴリ・空き状況フィルタ）
- ✅ 店舗詳細モーダル
- ✅ レスポンシブデザイン

### 2. 店舗管理者用アプリ (`/shop-manager/*`)
**目的**: 店舗管理者が店舗情報と空き状況を管理

#### 認証
- `/shop-manager/login` - ログイン画面

#### 管理画面
- `/shop-manager` - ダッシュボード（デフォルト）
- `/shop-manager/dashboard` - ダッシュボード（明示的）
- `/shop-manager/shop` - 店舗情報編集
- `/shop-manager/availability` - 空き状況更新
- `/shop-manager/profile` - プロフィール設定（将来実装）

#### 現在実装済み機能
- ✅ ログイン画面（デモ用: manager1/password）
- ✅ ダッシュボード（空き状況クイック更新）
- ✅ 店舗情報編集（基本情報・営業時間・連絡先）
- ✅ 空き状況更新（QRコード管理機能付き）

#### 将来機能
- `/shop-manager/analytics` - アクセス分析
- `/shop-manager/settings` - 店舗設定

### 3. システム管理者用アプリ (`/admin/*`) **← 未実装**
**目的**: システム全体の管理

#### 認証
- `/admin/login` - 管理者ログイン

#### 管理画面
- `/admin` - 管理者ダッシュボード（デフォルト）
- `/admin/dashboard` - システム状況ダッシュボード
- `/admin/shops` - 店舗管理（CRUD）
- `/admin/managers` - 店舗管理者アカウント管理
- `/admin/settings` - システム設定（検索半径など）
- `/admin/logs` - アクセスログ・エラーログ
- `/admin/analytics` - システム分析
- `/admin/security` - セキュリティ管理

#### データ管理
- `/admin/backup` - データバックアップ
- `/admin/export` - データエクスポート

#### 実装予定
- 🔄 Phase 1 MVPで実装予定

### 4. 店舗スタッフ用アプリ (`/staff/*`)
**目的**: 店舗スタッフがQRコード経由で空き状況のみを更新

#### スタッフ用画面
- `/staff/availability?token=xxx` - スタッフ用空き状況更新（認証不要、合言葉必要）

#### 現在実装済み機能
- ✅ QRコード認証（token + 4桁合言葉）
- ✅ 空き状況更新（available/busy/full/closed）
- ✅ シンプルなUI（ヘッダーのみ）

### 5. 共通・特殊URL

#### ルート・リダイレクト
- `/` - 利用者用アプリにリダイレクト (`/user`) **← 現在の実装**
- `/login` - 認証が必要な場合のリダイレクト先選択

#### API（将来実装）
- `/api/v1/*` - REST API エンドポイント
- `/api/v1/auth/*` - 認証API
- `/api/v1/shops/*` - 店舗API
- `/api/v1/availability/*` - 空き状況API

#### エラー・特殊ページ
- `/404` - ページが見つからない
- `/500` - サーバーエラー
- `/maintenance` - メンテナンス中

## URL設計の原則

### 1. RESTful設計
- リソース名は複数形（`/shops`, `/managers`）
- HTTPメソッドで操作を表現（GET, POST, PUT, DELETE）
- 階層構造で関連性を表現

### 2. セキュリティ考慮
- 管理者機能は明確に分離（`/admin/*`）
- 認証が必要なページは明確に識別
- 権限に応じたアクセス制御

### 3. ユーザビリティ
- 直感的なURL構造
- ブックマーク可能なURL
- SEO対応（将来の検索エンジン対応）

### 4. スケーラビリティ
- バージョン管理（`/api/v1/*`）
- 機能拡張に対応した構造
- マイクロサービス化への対応

## 実装状況

### ✅ 完了
- **利用者用アプリ** (`/user/*`) - ルート表示（デフォルト）
  - `/` → `/user` へのリダイレクト
  - 店舗検索・一覧表示
  - 検索モーダル機能
  - レスポンシブデザイン
- **店舗管理者用アプリ** (`/shop-manager/*`)
  - `/shop-manager/login` - ログイン画面
  - `/shop-manager/` - ダッシュボード
  - `/shop-manager/shop` - 店舗情報編集
  - `/shop-manager/availability` - 空き状況更新

### 🔄 実装中
- システム管理者用アプリ (`/admin/*`)

### 📋 将来実装
- API エンドポイント (`/api/v1/*`)
- PWA機能 (`/manifest.json`, `/sw.js`)
- エラーページ (`/404`, `/500`)
- Google Maps統合 (`/user/map`)

## 認証・権限管理

### 認証レベル
1. **ゲスト**: 利用者用アプリの基本機能のみ
2. **店舗管理者**: 自分の店舗の管理機能
3. **システム管理者**: 全システムの管理機能

### セッション管理
- JWT + HTTP-only cookies
- 自動ログアウト（セッションタイムアウト）
- 複数デバイス対応

### アクセス制御
- ルートレベルでの権限チェック
- コンポーネントレベルでの表示制御
- APIレベルでの認証・認可
