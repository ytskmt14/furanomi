<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon-16x16.svg" />
    <link rel="icon" type="image/svg+xml" href="/favicon-32x32.svg" sizes="32x32" />
    <!-- Apple Touch Icon for iOS Safari -->
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- TDK設定 -->
    <title>ふらのみ - 近くの店舗の空き状況を確認</title>
    <meta name="description" content="居酒屋・カフェ・レストランの空き状況をリアルタイムで確認。混雑状況を見てからお店を選べます。" />
    <meta name="keywords" content="居酒屋,カフェ,レストラン,空き状況,混雑,リアルタイム,ふらのみ" />
    
    <!-- Canonical URL (HTTPSを強制) -->
    <link rel="canonical" href="https://furanomi.com" />
    
    <!-- OGP設定（基本） -->
    <meta property="og:title" content="ふらのみ - 近くの店舗の空き状況を確認" />
    <meta property="og:description" content="居酒屋・カフェ・レストランの空き状況をリアルタイムで確認。混雑状況を見てからお店を選べます。" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://furanomi.com" />
    <meta property="og:image" content="https://furanomi.com/OGP.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:alt" content="ふらのみロゴ" />
    <meta property="og:site_name" content="ふらのみ" />
    <meta property="og:locale" content="ja_JP" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ふらのみ - 近くの店舗の空き状況を確認" />
    <meta name="twitter:description" content="居酒屋・カフェ・レストランの空き状況をリアルタイムで確認。" />
    <meta name="twitter:image" content="https://furanomi.com/OGP.png" />
    
    <!-- その他のメタタグ -->
    <meta name="author" content="ふらのみ" />
    <meta name="theme-color" content="#3B82F6" />

    <!-- iOS 18 BFCache対策: キャッシュを完全に無効化 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <!-- PWA Manifest - パスに応じて動的に設定 -->
    <script>
      (function() {
        // 現在のパスに応じて適切なmanifestを選択
        const path = window.location.pathname;
        let manifestPath = '/manifest.json'; // デフォルト

        if (path.startsWith('/shop-manager')) {
          manifestPath = '/manifest-shop-manager.json';
        } else if (path.startsWith('/staff')) {
          manifestPath = '/manifest-staff.json';
        } else if (path.startsWith('/system-admin')) {
          manifestPath = '/manifest-system-admin.json';
        } else if (path.startsWith('/user')) {
          manifestPath = '/manifest-user.json';
        } else if (path === '/') {
          // ルートの場合は、保存されたパス情報から判断
          const installPathData = localStorage.getItem('pwa-install-path');
          if (installPathData) {
            try {
              const { path: savedPath } = JSON.parse(installPathData);
              if (savedPath && savedPath.startsWith('/shop-manager')) {
                manifestPath = '/manifest-shop-manager.json';
              } else if (savedPath && savedPath.startsWith('/staff')) {
                manifestPath = '/manifest-staff.json';
              } else if (savedPath && savedPath.startsWith('/system-admin')) {
                manifestPath = '/manifest-system-admin.json';
              } else if (savedPath && savedPath.startsWith('/user')) {
                manifestPath = '/manifest-user.json';
              }
            } catch (e) {
              // パースエラーの場合はデフォルトを使用
            }
          }
        }

        // manifestリンクを動的に追加
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = manifestPath;
        document.head.appendChild(link);

        console.log('[PWA] Manifest loaded:', manifestPath);
      })();
    </script>
    
    <!-- Google Search Console所有権確認 -->
    <meta name="google-site-verification" content="m01IEvURxKgXdvDq1KZ0OBy60S3M-Cp0uDqwcQrrhFE" />
    
    <!-- 構造化データ（JSON-LD） -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "ふらのみ",
      "url": "https://furanomi.com",
      "description": "居酒屋・カフェ・レストランの空き状況をリアルタイムで確認できるサービス",
      "inLanguage": "ja",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://furanomi.com?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
  </head>
  <body>
    <!-- iOS 18 BFCache対策: ページがBFCacheから復元された場合は強制リロード -->
    <script>
      (function() {
        // pageshow イベントでBFCache復元を検出
        window.addEventListener('pageshow', function(event) {
          if (event.persisted) {
            console.log('[BFCache] Page restored from BFCache, forcing reload...');
            window.location.reload();
          }
        });

        // pagehide イベントでBFCacheを無効化
        window.addEventListener('pagehide', function(event) {
          // BFCacheを無効化するため、unloadイベントリスナーを追加
          // （何もしないが、存在するだけでBFCacheが無効化される）
        });

        // unload イベントリスナーを追加してBFCacheを無効化
        window.addEventListener('unload', function() {
          // 何もしない（存在するだけでBFCacheが無効化される）
        });
      })();
    </script>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
